<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>رفع صور إلى Google Drive</title>
<script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
<h2>رفع صورة إلى Google Drive</h2>
<input type="file" id="fileInput">
<button onclick="handleAuthClick()">تسجيل الدخول ورفع الصورة</button>
<p id="result"></p>

<script>
const CLIENT_ID = '1051707223171-f04cagn8stpibl81b8l2iri5vb2rjsa7.apps.googleusercontent.com';
const SCOPES = 'https://www.googleapis.com/auth/drive.file';

function handleAuthClick() {
    gapi.load('client:auth2', initClient);
}

function initClient() {
    gapi.client.init({
        clientId: CLIENT_ID,
        scope: SCOPES,
    }).then(() => {
        gapi.auth2.getAuthInstance().signIn().then(uploadFile);
    });
}

function uploadFile() {
    const fileInput = document.getElementById('fileInput');
    const file = fileInput.files[0];
    if (!file) { alert('اختر صورة أولاً!'); return; }

    const metadata = {
        'name': file.name,
        'mimeType': file.type
    };

    const accessToken = gapi.auth.getToken().access_token;
    const form = new FormData();
    form.append('metadata', new Blob([JSON.stringify(metadata)], {type: 'application/json'}));
    form.append('file', file);

    fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id', {
        method: 'POST',
        headers: new Headers({'Authorization': 'Bearer ' + accessToken}),
        body: form
    })
    .then(response => response.json())
    .then(data => {
        const fileId = data.id;
        const directLink = `https://drive.google.com/uc?export=view&id=${fileId}`;
        document.getElementById('result').innerHTML = 
            `تم الرفع! رابط الصورة: <a href="${directLink}" target="_blank">${directLink}</a>`;
    })
    .catch(err => console.error(err));
}
</script>
</body>
</html>
